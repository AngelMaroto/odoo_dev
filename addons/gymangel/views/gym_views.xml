<odoo>
  <data>

    <!--1. MENÚS (Navaegación)-->

    <menuitem id="menu_gym_root" name="Gimnasio Angel" web_icon="gym_angel,static/description/icon.png"/>

    <menuitem id="menu_gym_management" name="Gestión" parent="menu_gym_root" sequence="10"/>
    <menuitem id="menu_gym_config" name="Configuración" parent="menu_gym_root" sequence="20"/>

    <!--2. Vistas del modelo sesion-->
    <!--vista kanban-->
    <record id="view_gym_session_form" model="ir.ui.view">
        <field name="name">gym.session.form</field>
        <field name="model">gym.session</field>
        <field name="arch" type="xml">
            <form string="Sesión">
                <sheet>
                    <div class="oe_title">
                        <h1><field name="name"/></h1>
                    </div>
                    
                    <group>
                        <group>
                            <field name="activity_id"/>
                            <field name="instructor_id"/>
                            <field name="occupied_seats"/> 
                            <field name="occupied_percentage" widget="progressbar" string="Progreso Ocupación"/>
                        </group>
                        <group>
                            <field name="start_date"/>
                            <field name="duration"/>
                            <field name="capacity"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Asistentes">
                            <field name="booking_ids">
                                <tree editable="bottom">
                                    <field name="member_id"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_gym_session_tree" model="ir.ui.view">
        <field name="name">gym.session.tree</field>
        <field name="model">gym.session</field>
        <field name="arch" type="xml">
            <tree decoration-danger="available_seats == 0" decoration-info="available_seats &gt; 0">
                <field name="name"/>
                <field name="instructor_id"/>
                <field name="start_date"/>
                <field name="available_seats"/>
            </tree>
        </field>
    </record>

    <record id="view_gym_session_kanban" model="ir.ui.view">
        <field name="name">gym.session.kanban</field>
        <field name="model">gym.session</field>
        <field name="arch" type="xml">
            <kanban default_group_by="activity_id" class="o_kanban_small_column">
                <field name="name"/>
                <field name="instructor_id"/>
                <field name="available_seats"/>
                <field name="color"/>
                
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_color_#{kanban_getcolor(record.color.raw_value)} oe_kanban_card oe_kanban_global_click">
                            
                            <div class="o_dropdown_kanban dropdown">
                                <a class="dropdown-toggle o-no-caret btn" role="button" data-toggle="dropdown" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                    <span class="fa fa-ellipsis-v"/>
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <t t-if="widget.editable"><a role="menuitem" type="edit" class="dropdown-item">Editar</a></t>
                                    <t t-if="widget.deletable"><a role="menuitem" type="delete" class="dropdown-item">Borrar</a></t>
                                    <ul class="oe_kanban_colorpicker" data-field="color"/>
                                </div>
                            </div>

                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <strong class="o_kanban_record_title">
                                        <field name="name"/>
                                    </strong>
                                </div>
                                <div class="o_kanban_record_body">
                                    <span class="text-muted">Monitor: </span>
                                    <field name="instructor_id"/>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <span class="badge badge-primary">
                                            Libres: <field name="available_seats"/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="action_gym_session" model="ir.actions.act_window">
        <field name="name">Clases Programadas</field>
        <field name="res_model">gym.session</field>
        <field name="view_mode">kanban,tree,form</field> 
    </record>

    <menuitem id="menu_gym_session" parent="menu_gym_management" action="action_gym_session"/>


    <!--3. Vistas del modelo reserva-->
    <!--barra de estado (statusbar)-->
    <record id="view_gym_booking_form" model="ir.ui.view">
        <field name="name">gym.booking.form</field>
        <field name="model">gym.booking</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_confirm" 
                        string="Confirmar" 
                        type="object" 
                        class="oe_highlight" 
                        invisible="state != 'draft'"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1><field name="code"/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="member_id"/>
                            <field name="session_id"/>
                        </group>
                        <group>
                            <field name="booking_date"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_gym_booking_tree" model="ir.ui.view">
        <field name="name">gym.booking.tree</field>
        <field name="model">gym.booking</field>
        <field name="arch" type="xml">
            <tree>
                <field name="code"/>
                <field name="session_id"/>
                <field name="member_id"/>
                <field name="state" widget="badge" decoration-success="state == 'confirmed'" decoration-muted="state == 'draft'"/>
            </tree>
        </field>
    </record>

    <record id="action_gym_booking" model="ir.actions.act_window">
        <field name="name">Reservas</field>
        <field name="res_model">gym.booking</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_gym_booking" parent="menu_gym_management" action="action_gym_booking"/>


    <!--4. Vistas del modelo res.partner (socios y monitores)-->
    <!--modificar vista existente con XPath-->
    <record id="view_gym_member_inherit" model="ir.ui.view">
        <field name="name">res.partner.gym.inherit</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            
            <xpath expr="//notebook/page[@name='internal_notes']" position="after">
                <page string="Gimnasio" name="gym_page">
                    <group>
                        <field name="is_gym_member"/>
                        <field name="is_instructor"/>
                    </group>
                </page>
            </xpath>

        </field>
    </record>

    <record id="action_gym_member" model="ir.actions.act_window">
        <field name="name">Socios</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_gym_member', '=', True)]</field>
        <field name="context">{'default_is_gym_member': True}</field>
    </record>

    <menuitem id="menu_gym_member" parent="menu_gym_management" action="action_gym_member"/>


    <!--5. Vistas del modelo actividad, equipamiento e instructor-->
    <record id="action_gym_activity" model="ir.actions.act_window">
        <field name="name">Actividades</field>
        <field name="res_model">gym.activity</field>
        <field name="view_mode">tree,form</field>
    </record>
    
    <record id="action_gym_equipment" model="ir.actions.act_window">
        <field name="name">Equipamiento</field>
        <field name="res_model">gym.equipment</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="menu_gym_activity" parent="menu_gym_config" action="action_gym_activity"/>
    <menuitem id="menu_gym_equipment" parent="menu_gym_config" action="action_gym_equipment"/>

    <record id="action_gym_instructor" model="ir.actions.act_window">
        <field name="name">Monitores</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_instructor', '=', True)]</field>
        <field name="context">{'default_is_instructor': True}</field>
    </record>

    <menuitem id="menu_gym_instructor" 
              name="Monitores" 
              parent="menu_gym_config" 
              action="action_gym_instructor" 
              sequence="5"/>

  </data>
</odoo>